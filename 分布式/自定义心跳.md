# Java Socket

**client**

```
	public class Client {
    //server监听的端口号
    public static final int PORT = 8088;
    public static final String IP = "127.0.0.1";

    public  boolean  start() throws IOException {
        //Creates a stream socket and connects it 也就是server为127.0.0.1:8088
        Socket socket = new Socket(IP, PORT);
        //server response
        try (BufferedInputStream is = new BufferedInputStream(socket.getInputStream())) {
            // client request
            try (BufferedOutputStream os = new BufferedOutputStream(socket.getOutputStream())) {
                os.write("client request\n".getBytes(StandardCharsets.UTF_8));
                os.flush();
                //告诉server 管道已结束
                socket.shutdownOutput();

                byte[] buffer = new byte[1024];
                int len;
                while ((len = is.read(buffer)) != -1) {
                    System.out.println("server msg: " + new String(buffer,0,len));
                }
                socket.close();
            }
        }
        return true;

    }

    public static void main(String[] args) {
        Client client = new Client();
        try {
            client.start();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

```

**Server**

```
public class Server {
    //server监听的端口号
    public static final int PORT = 8088;

    private static final Server INSTANCE = new Server();

    public static Server getInstance() {
        return INSTANCE;
    }

    public void start() throws IOException {
        //Creates a server socket, bound to the specified port 也就是server.port=8088
        ServerSocket sever = new ServerSocket(PORT);
        System.out.println("server is starting.....");
        Socket socket = null;
        while ((socket = sever.accept()) != null) {
            System.out.println("client Ip: " + socket.getInetAddress().getHostAddress()
                    + ", port: " + socket.getPort());
            //client message
            try (BufferedInputStream inputStream = new BufferedInputStream(socket.getInputStream())) {
                //server response
                try (BufferedOutputStream outputStream = new BufferedOutputStream(socket.getOutputStream())) {
                    byte[] buffer = new byte[1024];
                    int len;
                    while ((len = inputStream.read(buffer)) != -1) {
                        System.out.println("client msg: " + new String(buffer,0,len));
                        //response
                        outputStream.write("server response\n".getBytes(StandardCharsets.UTF_8));
                        outputStream.flush();
                    }
                    System.out.println("client is  closed");

                }
            }
        }

    }

    public static void main(String[] args) {
        Server server = Server.getInstance();
        try {
            server.start();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

}
```

注意点: inputStream.read(byte[])读取到流的结尾，才会返回-1,但由于管道中没有结束符,导致服务端一直读取不到结束,所以卡在了while循环.客户端的输出流循环完毕后，执行一下**socket.shutdownOutput()**方法，此方法告诉服务端，此管道已结束数据传输

