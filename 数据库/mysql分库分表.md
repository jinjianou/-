# 为什么要分库分表

如果业务量剧增(qps)，数据库可能会出现性能瓶颈，这时候我们就需要考虑拆分数据库。  提升性能,提高可用性

1. 换数据库 缓存 Nosql
2. 慢sql,索引,字段
3. 读写分离
4. 分库分表

# 什么是分库分表

单库单表的数据分散到n个库或n个表



# 分库分表的几种方式

 分库(垂直|水平):

​	垂直:按业务拆分总库->多个库

​	水平拆库:按照某种规则 将某个库拆成相同结构的若干个库

 分表(垂直|水平):

​	mysql单表最大容量是4GB(3.22以前)/64pb(对记录数没限制),推荐500w行或2GB考虑分表



​	垂直:按列拆分(确定关联列),本质也是按业务拆分

​	水平: 按照某种规则 将某个表拆成相同结构的若干个表(保证均衡)



垂直 特点:

1. 每个库(表)结构不一样
2. 每个库(表)数据至少有一列是一样的
3. 每个库(表)的并集是全量数据

垂直 优点:

1. 拆分后业务清晰(专库专用)
2. 数据维护简单

垂直 缺点:

1. 单表数据量大,写读压力大(读写速度变慢) 

   磁盘 扇区 512字节 文件系统 块 4K  innodb存储引擎 页 16K

   **当一个表的索引无法放入到内存中会导致性能下降**(需要把部分索引装载到磁盘中，此时出现了性能的明显下降)，而与实际记录的条数无关





水平特点:

1. 每个库(表)结构一样
2. 每个库(表)数据是不一样的
3. 每个库(表)的并集是全量数据

水平优点:

1. 单库(表)数据量保持一定的数据量,有助于性能的提升
2. 提高了系统的稳定性和负载能力

水平缺点:

1. 数据扩容有难度,维护量大
2.  分片事务的一致性的问题 ,部分业务无法关联jion,只能通过java程序接口调用



场景:

​	订单数据库应该怎么拆分? 分情况:

​	前端(我的订单 订单详情 以我为中心) userid

​	后台(统计 以订单为维度) orderid





# 分库分表会带来什么问题

1. 分布式事务
2. 跨库join
3. 分布式全局唯一id